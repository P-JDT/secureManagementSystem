<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- create by autoCode,v1.0.0 -->
<mapper namespace="manage.NvhlBase">
	<!-- 保险订单查询 -->
	<select id="manage.NvhlBase.selectPageList"
		parameterType="net.jeeshop.services.manage.NvhlBaseVO.bean.NvhlBaseVO"
		resultType="net.jeeshop.services.manage.NvhlBaseVO.bean.NvhlBaseVO">
		select n.id,n.SerialNumber,IFNULL(DATEDIFF(NOW(),n.TInsrncEndTm),'') expire_days, 
		n.CProdName,n.CAppNo,n.status,n.CProdNo,n.appCde,n.NAmt,n.NPrm,n.TAppTm,
		n.TInsrncBgnTm,n.TInsrncEndTm,n.createtime,n.CSlsNme 
		from nvhlbasevo n where 1=1 and deleteFlag='0'
		<if test="createAccount!=null and createAccount!=''">
			and n.createAccount=#{createAccount}
		</if>
		<if test="appCde !=null and appCde !=''">
			and n.appCde=#{appCde}
		</if>
		<if test="TInsrncEndTmStartDate!=null and TInsrncEndTmStartDate!=''">
			and TInsrncEndTm &gt;= #{TInsrncEndTmStartDate}
		</if>
		<if test="TInsrncEndTmEndDate!=null and TInsrncEndTmEndDate!=''">
			and TInsrncEndTm &lt;= #{TInsrncEndTmEndDate}
		</if>		
		<if test="CProdName !=null and CProdName !=''">
			and n.CProdName like CONCAT('%','${CProdName}','%' )
		</if>
		<if test="payNo !=null and payNo !=''">
			and n.payNo = #{payNo}
		</if>
		group by n.SerialNumber
		order by createtime desc,TAppTm,TInsrncEndTm 	
			limit #{offset},#{pageSize}
	</select>
	<select id="manage.NvhlBase.selectOne"
		parameterType="net.jeeshop.services.manage.NvhlBaseVO.bean.NvhlBaseVO"
		resultType="net.jeeshop.services.manage.NvhlBaseVO.bean.NvhlBaseVO">
		select * from nvhlbasevo p where 1=1 
		<if test="payNo !=null and payNo !=''">
			and payNo=#{payNo}
		</if>	
		<if test="serialNumber !=null and serialNumber !=''">
			and serialNumber=#{serialNumber}
		</if>
		<if test="id !=null and id !=''">
			and id=#{id}
		</if>				
		</select>
	<!-- 保险订单查询分页 -->
	<select id="manage.NvhlBase.selectPageCount"
		parameterType="net.jeeshop.services.manage.NvhlBaseVO.bean.NvhlBaseVO"
		resultType="java.lang.Integer">
		select count(*) from nvhlbasevo  d where 1=1
		<if test="createAccount!=null and createAccount!=''">
			and createAccount=#{createAccount}
		</if>
		<if test="TInsrncEndTmStartDate!=null and TInsrncEndTmStartDate!=''">
			and TInsrncEndTm &gt;= #{TInsrncEndTmStartDate}
		</if>
		<if test="TInsrncEndTmEndDate!=null and TInsrncEndTmEndDate!=''">
			and TInsrncEndTm &lt;= #{TInsrncEndTmEndDate}
		</if>
		<if test="CProdName !=null and CProdName !=''">
			and CProdName like CONCAT('%','${CProdName}','%' )
		</if>	
			
	</select>	
	<!-- 插入 基本信息 NvhlBase-->
	<insert id="manage.NvhlBase.insertNvhlBase"
		parameterType="net.jeeshop.services.manage.NvhlBaseVO.bean.NvhlBaseVO"
		useGeneratedKeys="true" keyProperty="id">
		insert into nvhlbasevo(		
		SerialNumber,CAppNo,AppNme,InsuredNme,AppCde,InsuredCde,	
		CProdNo,CProdName,NAmtRmbExch,NAmt,NPrmRmbExch,NPrm,TAppTm,TInsrncBgnTm,
		TInsrncEndTm,createAccount,createTime,status,deleteFlag,CSlsNme)
         values(
         #{serialNumber},#{CAppNo},#{appNme},#{insuredNme},#{appCde},#{insuredCde},
         #{CProdNo},#{CProdName},#{NAmtRmbExch},#{NAmt},#{NPrmRmbExch},#{NPrm},#{TAppTm}
  		,#{TInsrncBgnTm},#{TInsrncEndTm},#{createAccount},now(),#{status},#{deleteFlag},#{CSlsNme})
	</insert>
	<!--插入 投保人NvhlApplicantVO  -->
	<insert id="manage.NvhlBase.insertNvhlApplication"
		parameterType="net.jeeshop.services.manage.NvhlApplicantVO.bean.NvhlApplicantVO"
		useGeneratedKeys="true" keyProperty="id">
		insert into nvhlapplicantvo(
		AppCde,AppNme,ClntMrk,CertfCls,CertfCde,ClntAddr,		
		ZipCde,Email,Mobile,Country,
		CusRiskLvl,CustRiskRank,createAccount,createtime		
		)
         values(
         #{appCde},#{appNme},#{clntMrk},#{certfCls},#{certfCde},#{clntAddr},
         #{zipCde},#{email},#{mobile},#{country},
        #{cusRiskLvl},#{custRiskRank},#{createAccount},now())
	</insert>
	<!-- 插入 被保人NvhlInsuredVO -->
	<insert id="manage.NvhlBase.insertNvhlInsured"
		parameterType="net.jeeshop.services.manage.NvhlInsuredVO.bean.NvhlInsuredVO"
		useGeneratedKeys="true" keyProperty="id">
		insert into nvhlinsuredvo(
		InsuredCde,InsuredNme,ClntMrk,CCertfCls,CCertfCde,
		ClntAddr,ZipCde,CEmail,Mobile,Country,CusRiskLvl,
		CustRiskRank,createAccount,createtime)
         values(
         #{insuredCde},#{insuredNme},#{clntMrk},#{ccertfCls},#{ccertfCde},
         #{clntAddr},#{zipCde},#{cemail},#{mobile},#{country},
		#{cusRiskLvl},#{custRiskRank},#{createAccount},now())
	</insert>
	<!--删除投保人 -->
	<delete id="manage.NvhlBase.deleteNvhlApplication" parameterType="net.jeeshop.services.manage.NvhlApplicantVO.bean.NvhlApplicantVO">
		delete from  NvhlApplicantVO where  AppCde=#{appCde}
		<if test="appNme !=null and appNme !=''">
				and AppNme=#{appNme}
		</if>
		<if test="createAccount !=null and createAccount !=''">
			and createAccount =#{createAccount}
		</if>
	</delete>
	<!--删除被保人 -->
	<delete id="manage.NvhlBase.deleteNvhlInsured" parameterType="net.jeeshop.services.manage.NvhlInsuredVO.bean.NvhlInsuredVO">
		delete from  nvhlinsuredvo where  InsuredCde=#{insuredCde}
		<if test="insuredNme !=null and insuredNme !=''">
			and InsuredNme =#{insuredNme}
		</if>
		<if test="createAccount !=null and createAccount !=''">
			and createAccount =#{createAccount}
		</if>
	</delete>
	<!--更新支付申请号 -->
	<update id="manage.NvhlBase.updatePayNo"
		parameterType="net.jeeshop.services.manage.NvhlBaseVO.bean.NvhlBaseVO">
		update nvhlbasevo
		set
		updatetime=now()
		<if test="updateAccount !=null and updateAccount !=''">
			,updateAccount=#{updateAccount}
		</if>		
		<if test="status !=null and status !=''">
			,status=#{status}
		</if>
		<if test="payNo !=null and payNo !=''">
			,payNo=#{payNo}
		</if>
		where 1=1
		<if test="serialNumber !=null and serialNumber !=''">
			and serialNumber=#{serialNumber}
		</if>
	</update>
	<!--支付完成后更新订单信息 -->
	<update id="manage.NvhlBase.update"
		parameterType="net.jeeshop.services.manage.NvhlBaseVO.bean.NvhlBaseVO">
		update nvhlbasevo
		set
		updatetime=now(),updateAccount=#{updateAccount}
		<if test="status !=null and status !=''">
			,status=#{status}
		</if>
		<if test="cashNo !=null and cashNo !=''">
			,cashNo=#{cashNo}
		</if>
		<if test="payType !=null and payType !=''">
			,payType=#{payType}
		</if>
		<if test="bankAcctDate !=null and bankAcctDate !=''">
			,bankAcctDate=#{bankAcctDate}
		</if>
		
		<if test="bankCode !=null and bankCode !=''">
			,bankCode=#{bankCode}
		</if>
		<if test="tidNo !=null and tidNo !=''">
			,tidNo=#{tidNo}
		</if>

		<if test="bkSerial !=null and bkSerial !=''">
			,bkSerial=#{bkSerial}
		</if>
		<if test="cardNo !=null and cardNo !=''">
			,cardNo=#{cardNo}
		</if>
		<if test="remark !=null and remark !=''">
			,remark=#{remark}
		</if>
		where 1=1
		<if test="payNo !=null and payNo !=''">
			and payNo=#{payNo}
		</if>
	</update>
</mapper>
